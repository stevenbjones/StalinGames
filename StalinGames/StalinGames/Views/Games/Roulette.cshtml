@model ApplicationUser
@{
    ViewData["Title"] = "Roulette";
}
<style>
    .red {
        background-color: red;
        border: red;
        font-size: 5em;
    }

    .black {
        background-color: black;
        border: black;
        font-size: 5em;
    }

    .board {
        /*
          transform: rotate(270deg);
          margin-top: -50%;
          margin-left: -20em;
        */
    }


    #rouletteCard {
         margin-left: 13%;
        display: inline-flex;
    width: 50%;
        position: absolute;
        margin-top: 7%;
    }

    #canvas {
        /* margin-left:50%; */
        display: inline-flex;
        flex: auto;
        flex-direction: row;
    }

    .container {
        margin-left: 0em;
    }
</style>

<canvas id="canvas" height="500em" width="500em"></canvas>

<div class="card mb-3 bg-dark" style="padding: 1.5em;margin-top: 1em;background-color: #702c2c " id="rouletteCard">
    <div class="card mb-3  bg-dark">
        <div class="card-header" style="font-size: 2.5em; text-align: center">
            <span id="Message">Play</span> <input disabled="" style="width: 6em; display:inline; float:right;" type="number" value="285755" class="form-control" id="Blyats">
        </div>
    </div>
    <div class="card mb-3  bg-dark">
        <div class="card-body">
            <div id="board" class="board">
                <div>
                    <button id="value1" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">1</button>
                    <button id="value2" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">2</button>
                    <button id="value3" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">3</button>
                </div>

                <div>
                    <button id="value4" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">4</button>
                    <button id="value5" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">5</button>
                    <button id="value6" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">6</button>
                </div>

                <div>
                    <button id="value7" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">7</button>
                    <button id="value8" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">8</button>
                    <button id="value9" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">9</button>
                </div>

                <div>
                    <button id="value10" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">10</button>
                    <button id="value11" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">11</button>
                    <button id="value12" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">12</button>
                </div>

                <div>
                    <button id="value13" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">13</button>
                    <button id="value14" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">14</button>
                    <button id="value15" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">15</button>
                </div>

                <div>
                    <button id="value16" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">16</button>
                    <button id="value17" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">17</button>
                    <button id="value18" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">18</button>
                </div>

                <div>
                    <button id="value19" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">19</button>
                    <button id="value20" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">20</button>
                    <button id="value21" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">21</button>
                </div>

                <div>
                    <button id="value22" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">22</button>
                    <button id="value23" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">23</button>
                    <button id="value24" class="btn red" style="/* width: 25%; */font-size:1.5em;color:white;">24</button>
                </div>

                <div>
                    <button id="value25" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">25</button>
                    <button id="value26" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">26</button>
                    <button id="value27" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">27</button>
                </div>

                <div>
                    <button id="value28" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">28</button>
                    <button id="value29" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">29</button>
                    <button id="value30" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">30</button>
                </div>
                <div>
                    <button id="value31" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">31</button>
                    <button id="value32" class="btn red" style="/* width: 25%; */font-size:1.5em;color:white;">32</button>
                    <button id="value33" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">33</button>
                </div>

                <div>
                    <button id="value34" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">34</button>
                    <button id="value35" class="btn black" style="/* width: 25%; */font-size:1.5em;color:white;">35</button>
                    <button id="value36" class="btn red"  style="/* width: 25%; */font-size:1.5em;color:white;">36</button>
                </div>
                <div>
                    <button id="valuered" class="btn red" style="/* width: 25%; */font-size:1.5em;color:white;">red</button>
                    <button id="valueblack" class="btn black"  style="/* width: 25%; */font-size:1.5em;color:white;">black</button>               
                </div>
            </div>
        </div>
        <div id="divGegokteWaarden"></div>
    </div>
    <div class="card mb-3  bg-primary" style="display: flex;flex: auto;flex-direction: row;">
        <button class="btn bg-primary" disabled="" style="width: 25%;font-size:1.5em;color:white;" id="btnSpinWheel">SPIN</button>
        <button class="btn bg-warning" style="width: 35%;font-size:1.5em;color:white;" id="btnStopBetting">STOP BETTING</button>
        <input style="height: auto;" type="number" class="form-control" placeholder="0" id="betvalue">
    </div>
</div>

        <script type="text/javascript">
            window.addEventListener('load', function () {

                /*************Wheel variabelen******************* */
                var options = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36"];

                var startAngle = 0;
                var arc = Math.PI / (options.length / 2);
                var spinTimeout = null;

                var spinArcStart = 10;
                var spinTime = 0;
                var spinTimeTotal = 0;

                var ctx;


                /*********Script variabelen***************** */
                let btnStopBetting = document.querySelector("#btnStopBetting");
                let btnSpinWheel = document.querySelector("#btnSpinWheel");
                let Bets = "";
                let GambledValues = "";
                let GambledColor = "";
                let BetOnColor = 0;

                btnSpinWheel.addEventListener("click", spin);
                //Teken board
                for (let i = 1; i <= 36; i++) {
                    this.document.querySelector(`#value${i}`).addEventListener("click", function () {
                        value(i);
                    })
                }

                //Knop voor op red te gokken
                this.document.querySelector("#valuered").addEventListener("click", function () {
                    alert("knop rood");
                    if (GambledColor.includes("red")) {
                        alert("U kan niet 2 keer op red gokken");
                        return;
                    }
                    if (GambledColor.includes("black")) {
                        alert("U kan niet op 2 kleuren gokken");
                        return;
                    }
                    else {
                        GambledColor = "red"
                        BetOnColor = document.getElementById("betvalue").value;
                        document.getElementById("divGegokteWaarden").innerHTML += `${document.getElementById("betvalue").value} op ${GambledColor},`;
                    }

                    //knop voor op black te gokken
                })
                this.document.querySelector("#valueblack").addEventListener("click", function () {
                    if (GambledColor.includes("black")) {
                        alert("U kan niet 2 keer op black gokken");
                        return;
                    }
                    if (GambledColor.includes("red")) {
                        alert("U kan niet op 2 kleuren gokken");
                        return;
                    }
                    else {
                        GambledColor = "black"
                        BetOnColor = document.getElementById("betvalue").value;
                        document.getElementById("divGegokteWaarden").innerHTML += `${document.getElementById("betvalue").value} op ${GambledColor},`;
                    }
                })



                //Voeg gegogkte valuen toe in een array
                function value(cijfer) {
                    Bets += `${document.getElementById("betvalue").value},`;
                     GambledValues += `${cijfer},`;
                    document.getElementById("divGegokteWaarden").innerHTML += `${document.getElementById("betvalue").value} op ${cijfer},`;
                }

                //Teken roulette
                function drawRouletteWheel() {
                    var canvas = document.getElementById("canvas");
                    if (canvas.getContext) {
                        var outsideRadius = 200;
                        var textRadius = 160;
                        var insideRadius = 125;

                        ctx = canvas.getContext("2d");
                        ctx.clearRect(0, 0, 500, 500);

                        ctx.strokeStyle = "black";
                        ctx.lineWidth = 2;

                        ctx.font = 'bold 12px Helvetica, Arial';

                        for (var i = 0; i < options.length; i++) {
                            var angle = startAngle + i * arc;
                            //ctx.fillStyle = colors[i];
                            if (i % 2 == 0) {
                                //black
                                ctx.fillStyle = "#000000"
                            }
                            else {
                                //red
                                ctx.fillStyle = "#F50A0A"
                            }

                            ctx.beginPath();
                            ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
                            ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
                            ctx.stroke();
                            ctx.fill();

                            ctx.save();
                            ctx.shadowOffsetX = -1;
                            ctx.shadowOffsetY = -1;
                            ctx.shadowBlur = 0;
                            ctx.shadowColor = "rgb(220,220,220)";
                            ctx.fillStyle = "black";
                            ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius,
                                250 + Math.sin(angle + arc / 2) * textRadius);
                            ctx.rotate(angle + arc / 2 + Math.PI / 2);
                            var text = options[i];
                            ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                            ctx.restore();
                        }

                        //Arrow
                        ctx.fillStyle = "black";
                        ctx.beginPath();
                        ctx.moveTo(250 - 4, 250 - (outsideRadius + 5));
                        ctx.lineTo(250 + 4, 250 - (outsideRadius + 5));
                        ctx.lineTo(250 + 4, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 + 9, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 + 0, 250 - (outsideRadius - 13));
                        ctx.lineTo(250 - 9, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 - 4, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 - 4, 250 - (outsideRadius + 5));
                        ctx.fill();
                    }
                }

                function spin() {
                    spinAngleStart = Math.random() * 10 + 10;
                    spinTime = 5;
                    spinTimeTotal = Math.random() * 3 + 4 * 1000;
                    callRotateWheel();
                }

                btnStopBetting.addEventListener("click", function () {
                    btnSpinWheel.disabled = false;
                    var ArrayGegokstevaluen =  GambledValues.split(",");
                    var ArrayBet = Bets.split(",");
                    console.log(ArrayGegokstevaluen);

                     GambledValues = ArrayGegokstevaluen;                                  
                    Bets = ArrayBet;       

                })

                function rotateWheel() {
                    spinTime += 30;
                    if (spinTime >= spinTimeTotal) {
                        //stopRotateWheel();
                        return;
                    }
                    var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
                    startAngle += (spinAngle * Math.PI / 180);
                    drawRouletteWheel();
                }

                //Gebruik deze functie om RotateWheel verschillende keren te herhalen
                function callRotateWheel() {
                    for (let i = 0; i < (Math.floor(Math.random() * 50)); i++) {
                        rotateWheel();
                    }
                    stopRotateWheel();
                }

                function stopRotateWheel() {
                    clearTimeout(spinTimeout);
                    var degrees = startAngle * 180 / Math.PI + 90;
                    var arcd = arc * 180 / Math.PI;
                    var index = Math.floor((360 - degrees % 360) / arcd);
                    ctx.save();
                    ctx.font = 'bold 30px Helvetica, Arial';
                    var text = options[index]

                    checkProfit(text);
                    console.log( GambledValues);
                    console.log(Bets);
                    console.log(GambledColor);

                    ctx.fillText(text, 250 - ctx.measureText(text).width / 2, 250 + 10);
                    ctx.restore();
                }

                function checkProfit(resultaat) {
                    let totaleInzet = 0;
                    let totaleWinst = 0;

                    for (let i = 1; i <  GambledValues.length; i++) {
                        if (resultaat == ( GambledValues[i])) {
                            //hier komt de winst
                            console.log(`U heeft ${Bets[i]} ingezet op ${ GambledValues[i]} hierdoor wint u ${Bets[i] * 100} `)
                            totaleWinst += Bets[i] * 100;
                        }
                        totaleInzet += Bets[i];
                    }

                    switch (GambledColor) {
                        case "":
                            console.log("geen gok op kleur");
                            break;
                        case "red":
                            if (resultaat % 2 == 0) {
                                console.log(`U heeft ${BetOnColor} ingezet op red, hierdoor wint u ${BetOnColor * 10}`)
                                totaleWinst += BetOnColor * 10;
                            }
                            else {
                                console.log("het was black" + BetOnColor + "Verloren")
                                totaleInzet += BetOnColor
                            }
                            break;
                        case "black":
                            if (resultaat % 2 != 0) {
                                console.log(`U heeft ${BetOnColor} ingezet op black, hierdoor wint u ${BetOnColor * 10}`)
                                totaleWinst += BetOnColor * 10;
                            }
                            else {
                                console.log("het was red" + BetOnColor + "Verloren")
                                totaleInzet += BetOnColor
                            }
                            break;

                        // code block
                    }
                    $.ajax({
                        type: 'POST',
                        url: '/Games/SlotMachine',
                        data: { getal: totaleWinst - totaleInzet },
                        success: function (result) {
                            blyats = result;
                            document.getElementById("Blyats").value = blyats;
                        }
                    });

                }

                function easeOut(t, b, c, d) {
                    var ts = (t /= d) * t;
                    var tc = ts * t;
                    return b + c * (tc + -3 * ts + 3 * t);
                }

                drawRouletteWheel();
            })
        </script>
