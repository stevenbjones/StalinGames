@model ApplicationUser
@{
    ViewData["Title"] = "Roulette";
}
<style>
    .red {
        background-color: red;
        border: red;
        font-size: 5em;
    }

    .black {
        background-color: black;
        border: black;
        font-size: 5em;
    }

    .board {
        /*
          transform: rotate(270deg);
          margin-top: -50%;
          margin-left: -20em;
        */
    }


    #rouletteCard {
         margin-left: 13%;
        display: inline-flex;
    width: 50%;
        position: absolute;
        margin-top: 7%;
    }

    #canvas {
        /* margin-left:50%; */
        display: inline-flex;
        flex: auto;
        flex-direction: row;
    }

    .container {
        margin-left: 0em;
    }
</style>

<canvas id="canvas" height="500em" width="500em"></canvas>

<div class="card mb-3 bg-dark" style="padding: 1.5em;margin-top: 1em;background-color: #702c2c " id="rouletteCard">
    <div class="card mb-3  bg-dark">
        <div class="card-header" style="font-size: 2.5em; text-align: center">
            <span id="Message">Play</span> <input disabled="" style="width: 6em; display:inline; float:right;" type="number" value="285755" class="form-control" id="Blyats">
        </div>
    </div>
    <div class="card mb-3  bg-dark">
        <div class="card-body">
            <div id="board" class="board">
                <div>
                    <button id="value1" class="btn red" disabled="" style="/* width: 25%; */font-size:1.5em;color:white;">1</button>
                    <span id="value2" class="red"> 2 </span>
                    <span id="value3" class="black"> 3 </span>
                </div>

                <div>
                    <span id="value4" class="red"> 4 </span>
                    <span id="value5" class="black"> 5 </span>
                    <span id="value6" class="red"> 6 </span>
                </div>

                <div>
                    <span id="value7" class="black"> 7 </span>
                    <span id="value8" class="red"> 8 </span>
                    <span id="value9" class="black"> 9 </span>
                </div>

                <div>
                    <span id="value10" class="red"> 10 </span>
                    <span id="value11" class="black"> 11 </span>
                    <span id="value12" class="red"> 12 </span>
                </div>

                <div>
                    <span id="value13" class="black"> 13 </span>
                    <span id="value14" class="red"> 14 </span>
                    <span id="value15" class="black"> 15 </span>
                </div>

                <div>
                    <span id="value16" class="red"> 16 </span>
                    <span id="value17" class="black"> 17 </span>
                    <span id="value18" class="red"> 18 </span>
                </div>

                <div>
                    <span id="value19" class="black"> 19 </span>
                    <span id="value20" class="red"> 20 </span>
                    <span id="value21" class="black"> 21 </span>
                </div>

                <div>
                    <span id="value22" class="red"> 22 </span>
                    <span id="value23" class="black"> 23 </span>
                    <span id="value24" class="red"> 24 </span>
                </div>

                <div>
                    <span id="value25" class="black"> 25 </span>
                    <span id="value26" class="red"> 26 </span>
                    <span id="value27" class="black"> 27 </span>
                </div>

                <div>
                    <span id="value28" class="red"> 28 </span>
                    <span id="value29" class="black"> 29 </span>
                    <span id="value30" class="red"> 30 </span>
                </div>
                <div>
                    <span id="value31" class="black"> 31 </span>
                    <span id="value32" class="red"> 32 </span>
                    <span id="value33" class="black"> 33 </span>
                </div>

                <div>
                    <span id="value34" class="red"> 34 </span>
                    <span id="value35" class="black"> 35 </span>
                    <span id="value36" class="red"> 36 </span>
                </div>
                <div>
                    <span id="valuered" class="red"> red </span>
                    <span id="valueblack" class="black"> black </span>
                </div>

            </div>

        </div>
    </div>
    <div class="card mb-3  bg-primary" style="display: flex;flex: auto;flex-direction: row;">
        <button class="btn bg-primary" disabled="" style="width: 25%;font-size:1.5em;color:white;" id="btnSpinWheel">SPIN</button>
        <button class="btn bg-warning" style="width: 35%;font-size:1.5em;color:white;" id="btnStopBetting">STOP BETTING</button>
        <input style="height: auto;" type="number" class="form-control" placeholder="0" id="betvalue">
    </div>
</div>

        <script type="text/javascript">
            window.addEventListener('load', function () {

                /*************Wheel variabelen******************* */
                var options = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36"];

                var startAngle = 0;
                var arc = Math.PI / (options.length / 2);
                var spinTimeout = null;

                var spinArcStart = 10;
                var spinTime = 0;
                var spinTimeTotal = 0;

                var ctx;


                /*********Script variabelen***************** */
                let btnStopBetting = document.querySelector("#btnStopBetting");
                let btnSpinWheel = document.querySelector("#btnSpinWheel");
                let bet = "";
                let gegoktevaluen = "";
                let gegokteKleur = "";

                btnSpinWheel.addEventListener("click", spin);
                //Teken board
                for (let i = 1; i <= 36; i++) {
                    this.document.querySelector(`#value${i}`).addEventListener("click", function () {
                        value(i);
                    })
                }

                //Knop voor op red te gokken
                this.document.querySelector("#valuered").addEventListener("click", function () {
                    if (gegokteKleur.includes("red")) {
                        alert("U kan niet 2 keer op red gokken");
                        return;
                    }
                    else {
                        gegokteKleur = "red"
                        window.betOpKleur = document.getElementById("betvalue").value;
                    }

                    //knop voor op black te gokken
                })
                this.document.querySelector("#valueblack").addEventListener("click", function () {
                    if (gegokteKleur.includes("black")) {
                        alert("U kan niet 2 keer op black gokken");
                        return;
                    }
                    else {
                        gegokteKleur = "black"
                        window.betOpKleur = document.getElementById("betvalue").value;
                    }
                })



                //Voeg gegogkte valuen toe in een array
                function value(cijfer) {
                    bet += `${document.getElementById("betvalue").value},`;
                    gegoktevaluen += `${cijfer},`

                }

                //Teken roulette
                function drawRouletteWheel() {
                    var canvas = document.getElementById("canvas");
                    if (canvas.getContext) {
                        var outsideRadius = 200;
                        var textRadius = 160;
                        var insideRadius = 125;

                        ctx = canvas.getContext("2d");
                        ctx.clearRect(0, 0, 500, 500);

                        ctx.strokeStyle = "black";
                        ctx.lineWidth = 2;

                        ctx.font = 'bold 12px Helvetica, Arial';

                        for (var i = 0; i < options.length; i++) {
                            var angle = startAngle + i * arc;
                            //ctx.fillStyle = colors[i];
                            if (i % 2 == 0) {
                                //black
                                ctx.fillStyle = "#000000"
                            }
                            else {
                                //red
                                ctx.fillStyle = "#F50A0A"
                            }

                            ctx.beginPath();
                            ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
                            ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
                            ctx.stroke();
                            ctx.fill();

                            ctx.save();
                            ctx.shadowOffsetX = -1;
                            ctx.shadowOffsetY = -1;
                            ctx.shadowBlur = 0;
                            ctx.shadowColor = "rgb(220,220,220)";
                            ctx.fillStyle = "black";
                            ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius,
                                250 + Math.sin(angle + arc / 2) * textRadius);
                            ctx.rotate(angle + arc / 2 + Math.PI / 2);
                            var text = options[i];
                            ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                            ctx.restore();
                        }

                        //Arrow
                        ctx.fillStyle = "black";
                        ctx.beginPath();
                        ctx.moveTo(250 - 4, 250 - (outsideRadius + 5));
                        ctx.lineTo(250 + 4, 250 - (outsideRadius + 5));
                        ctx.lineTo(250 + 4, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 + 9, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 + 0, 250 - (outsideRadius - 13));
                        ctx.lineTo(250 - 9, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 - 4, 250 - (outsideRadius - 5));
                        ctx.lineTo(250 - 4, 250 - (outsideRadius + 5));
                        ctx.fill();
                    }
                }

                function spin() {
                    spinAngleStart = Math.random() * 10 + 10;
                    spinTime = 5;
                    spinTimeTotal = Math.random() * 3 + 4 * 1000;
                    callRotateWheel();
                }

                btnStopBetting.addEventListener("click", function () {
                    btnSpinWheel.disabled = false;
                    var ArrayGegokstevaluen = gegoktevaluen.split(",");
                    var ArrayBet = bet.split(",");
                    console.log(ArrayGegokstevaluen);

                    window.gegoktevalue = ArrayGegokstevaluen;
                    window.gegokteKleur = gegokteKleur;
                    window.betOpKleur = betOpKleur;
                    window.Bets = ArrayBet;

                })

                function rotateWheel() {
                    spinTime += 30;
                    if (spinTime >= spinTimeTotal) {
                        //stopRotateWheel();
                        return;
                    }
                    var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
                    startAngle += (spinAngle * Math.PI / 180);
                    drawRouletteWheel();
                }

                //Gebruik deze functie om RotateWheel verschillende keren te herhalen
                function callRotateWheel() {
                    for (let i = 0; i < (Math.floor(Math.random() * 50)); i++) {
                        rotateWheel();
                    }
                    stopRotateWheel();
                }

                function stopRotateWheel() {
                    clearTimeout(spinTimeout);
                    var degrees = startAngle * 180 / Math.PI + 90;
                    var arcd = arc * 180 / Math.PI;
                    var index = Math.floor((360 - degrees % 360) / arcd);
                    ctx.save();
                    ctx.font = 'bold 30px Helvetica, Arial';
                    var text = options[index]

                    checkProfit(text);
                    console.log(window.gegoktevalue);
                    console.log(window.Bets);
                    console.log(window.gegokteKleur);

                    ctx.fillText(text, 250 - ctx.measureText(text).width / 2, 250 + 10);
                    ctx.restore();
                }

                function checkProfit(resultaat) {
                    let totaleInzet = 0;
                    let totaleWinst = 0;

                    for (let i = 1; i < window.gegoktevalue.length; i++) {
                        if (resultaat == (gegoktevalue[i])) {
                            //hier komt de winst
                            console.log(`U heeft ${window.Bets[i]} ingezet op ${window.gegoktevalue[i]} hierdoor wint u ${window.Bets[i] * 100} `)
                            totaleWinst += window.Bets[i] * 100;
                        }
                        totaleInzet += window.Bets[i];
                    }

                    switch (window.gegokteKleur) {
                        case "":
                            console.log("geen gok op kleur");
                            break;
                        case "red":
                            if (resultaat % 2 == 0) {
                                console.log(`U heeft ${window.betOpKleur} ingezet op red, hierdoor wint u ${window.betOpKleur * 10}`)
                                totaleWinst += window.betOpKleur * 10;
                            }
                            else {
                                console.log("het was black" + window.betOpKleur + "Verloren")
                                totaleInzet += window.betOpKleur
                            }
                            break;
                        case "black":
                            if (resultaat % 2 != 0) {
                                console.log(`U heeft ${window.betOpKleur} ingezet op black, hierdoor wint u ${window.betOpKleur * 10}`)
                                totaleWinst += window.betOpKleur * 10;
                            }
                            else {
                                console.log("het was red" + window.betOpKleur + "Verloren")
                                totaleInzet += window.betOpKleur
                            }
                            break;

                        // code block
                    }
                    $.ajax({
                        type: 'POST',
                        url: '/Games/SlotMachine',
                        data: { getal: totaleWinst - totaleInzet },
                        success: function (result) {
                            blyats = result;
                            document.getElementById("Blyats").value = blyats;
                        }
                    });

                }

                function easeOut(t, b, c, d) {
                    var ts = (t /= d) * t;
                    var tc = ts * t;
                    return b + c * (tc + -3 * ts + 3 * t);
                }

                drawRouletteWheel();
            })
        </script>
